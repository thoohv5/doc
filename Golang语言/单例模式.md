# 单例模式

# 单例实现

### 懒汉模式，非线程安全

```go
package singleton

type singleton struct {
}

var instance *singleton

func GetInstance() *singleton {
	if instance == nil {
		instance = &singleton{}
	}
	return instance
}
```

### 线程锁

```go
package singleton

import (
	"sync"
)

type singleton struct {
}

var (
	mu       sync.Mutex
	instance *singleton
)

func GetInstance() *singleton {
	mu.Lock()
	defer mu.Unlock()
	if instance == nil {
		instance = &singleton{}
	}
	return instance
}
```

### 检查锁

```go
package singleton

import (
	"sync"
)

type singleton struct {
}

var (
	mu       sync.Mutex
	instance *singleton
)

func GetInstance() *singleton {
	if instance == nil {
		mu.Lock()
		defer mu.Unlock()
		if instance == nil {
			instance = &singleton{}
		}
	}
	return instance
}
```

Once

```go
package singleton

import (
	"sync"
)

type singleton struct {
}

var (
	once     sync.Once
	instance *singleton
)

func GetInstance() *singleton {
	once.Do(func() {
		instance = &singleton{}
	})
	return instance
}
```

# 附录

[Go并发编程 - sync.Once 单实例模式的思考](https://mp.weixin.qq.com/s/ELnUQL-EnK8w8EpdbZKDWA)